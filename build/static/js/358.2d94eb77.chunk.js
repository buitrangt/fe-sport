"use strict";(self.webpackChunkedusports_frontend=self.webpackChunkedusports_frontend||[]).push([[358],{6339:(e,t,s)=>{s.d(t,{A:()=>a});const a=(0,s(3797).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},7358:(e,t,s)=>{s.r(t),s.d(t,{default:()=>E});var a=s(8),n=s(5043),r=s(2907),l=s(2543),c=s(2380),i=s(9256),o=s(1490),d=s(98),m=s(7251),h=s(2938),x=s(2817),u=s(8775),g=s(6787),p=s(6339),w=s(1172),N=s(2915);const f="/api/v1/news",y={getAllNews:async()=>{try{return await N.Ay.get(f)}catch(e){throw console.error("Error fetching all news:",e),e}},getNewsById:async e=>{try{return await N.Ay.get("".concat(f,"/").concat(e))}catch(t){throw console.error("Error fetching news with ID ".concat(e,":"),t),t}},createNews:async e=>{try{const t=await N.Ay.post(f,e);return t.data||t}catch(t){throw console.error("Error creating news:",t),t}},updateNews:async(e,t)=>{try{return await N.Ay.put("".concat(f,"/").concat(e),t)}catch(s){throw console.error("Error updating news with ID ".concat(e,":"),s),s}},deleteNews:async e=>{try{return await N.Ay.delete("".concat(f,"/").concat(e))}catch(t){throw console.error("Error deleting news with ID ".concat(e,":"),t),t}},uploadNewsAttachments:async(e,t,s)=>{try{const a=new FormData;a.append("files",t);const n=(0,N.uw)(s);return await N.Ay.post("".concat(f,"/uploads/").concat(e),a,n)}catch(a){throw console.error("Error uploading attachment for news ID ".concat(e,":"),a),a}},getImageUrl:e=>"".concat("http://localhost:8080").concat(f,"/image/").concat(e)};var b=s(9144),v=s(2339),j=s(579);const A=e=>{if(!e)return"N/A";const t={year:"numeric",month:"short",day:"numeric"};try{return new Date(e).toLocaleDateString(void 0,t)}catch(s){return console.error("Invalid date format:",e,s),"Invalid Date"}},E=()=>{var e,t,s,N;const[f,E]=(0,n.useState)(""),[D,C]=(0,n.useState)(1),[T,k]=(0,n.useState)(!1),[I,U]=(0,n.useState)({name:"",shortDescription:"",content:""}),[L,B]=(0,n.useState)(null),M=(0,n.useRef)(null),R=(0,r.useQueryClient)(),{data:S,isLoading:F,error:G}=(0,r.useQuery)(["admin-news",{page:D,searchTerm:f}],(async()=>{console.log("DEBUG FETCH: Fetching news with page:",D,"searchTerm:",f);const e=await y.getAllNews();let t=e;f&&(t=e.filter((e=>e.name.toLowerCase().includes(f.toLowerCase())||e.content.toLowerCase().includes(f.toLowerCase())||e.shortDescription&&e.shortDescription.toLowerCase().includes(f.toLowerCase()))));const s=6*(D-1),a=s+6;return{data:t.slice(s,a),pagination:{currentPage:D,totalPages:Math.ceil(t.length/6),totalItems:t.length,hasNext:D<Math.ceil(t.length/6),hasPrev:D>1}}}),{staleTime:12e4,keepPreviousData:!0,onError:e=>{console.error("DEBUG FETCH ERROR: Error fetching news articles:",e)}}),O=(0,r.useMutation)((e=>y.deleteNews(e)),{onSuccess:()=>{v.Ay.success("News article deleted successfully"),R.invalidateQueries("admin-news")},onError:e=>{console.error("DEBUG DELETE ERROR: Error deleting news article:",e)}}),P=(0,r.useMutation)((async e=>{var t,s;let{newsData:a,file:n}=e;console.log("DEBUG MUTATION START: newsData received:",a),console.log("DEBUG MUTATION START: file received:",n);const r=await y.createNews(a),l=null!==(t=null===r||void 0===r?void 0:r.id)&&void 0!==t?t:null===r||void 0===r||null===(s=r.data)||void 0===s?void 0:s.id;if(console.log("DEBUG MUTATION: News created with ID:",l),n){if(!l)throw console.error("DEBUG MUTATION ERROR: News ID is missing after creation, cannot upload attachment."),new Error("News ID not found after creation. Failed to upload attachment.");console.log("DEBUG MUTATION: Attempting to upload file '".concat(n.name,"' for news ID: ").concat(l)),await y.uploadNewsAttachments(l,n),console.log("DEBUG MUTATION: Attachment uploaded successfully.")}else console.log("DEBUG MUTATION: No file selected to upload, skipping attachment API call.");return r}),{onSuccess:()=>{v.Ay.success("News article created successfully"+(L?" and attachment uploaded!":"!")),R.invalidateQueries("admin-news"),k(!1),Q()},onError:e=>{console.error("DEBUG MUTATION ERROR: Error in createNewsMutation:",e),e.message&&e.message.includes("News ID not found")&&v.Ay.error("L\u1ed7i: Kh\xf4ng th\u1ec3 t\u1ea1o tin t\u1ee9c ho\u1eb7c l\u1ea5y ID \u0111\u1ec3 t\u1ea3i \u1ea3nh l\xean. Vui l\xf2ng th\u1eed l\u1ea1i.")}}),H=e=>{const{name:t,value:s}=e.target;U((e=>(0,a.A)((0,a.A)({},e),{},{[t]:s})))},Q=()=>{U({name:"",shortDescription:"",content:""}),B(null),M.current&&(M.current.value="")};return(0,n.useEffect)((()=>{T||Q()}),[T]),G?(0,j.jsxs)("div",{className:"text-center py-8",children:[(0,j.jsx)(l.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,j.jsx)("p",{className:"text-red-600",children:"Error loading news articles. Please try again later."})]}):(0,j.jsxs)("div",{className:"space-y-6 p-6",children:[(0,j.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"News Management"}),(0,j.jsx)("p",{className:"text-gray-600",children:"Create, edit, and publish news articles and announcements."})]}),(0,j.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,j.jsxs)("div",{className:"bg-purple-100 text-purple-800 px-4 py-2 rounded-full text-sm font-medium",children:[(null===S||void 0===S||null===(e=S.pagination)||void 0===e?void 0:e.totalItems)||0," Articles"]}),(0,j.jsxs)("button",{onClick:()=>k(!0),className:"btn-primary",children:[(0,j.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Create Article"]})]})]}),(0,j.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm",children:(0,j.jsxs)("form",{onSubmit:e=>{e.preventDefault(),C(1),R.invalidateQueries("admin-news")},className:"flex flex-col sm:flex-row gap-4",children:[(0,j.jsx)("div",{className:"flex-1",children:(0,j.jsxs)("div",{className:"relative",children:[(0,j.jsx)(i.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,j.jsx)("input",{type:"text",placeholder:"Search news articles by title or content...",value:f,onChange:e=>E(e.target.value),className:"pl-10 input-field"})]})}),(0,j.jsxs)("button",{type:"submit",className:"btn-primary whitespace-nowrap",children:[(0,j.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Search"]})]})}),(0,j.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm",children:[F?(0,j.jsxs)("div",{className:"p-8 text-center",children:[(0,j.jsx)(b.A,{}),(0,j.jsx)("p",{className:"text-gray-500 mt-2",children:"Loading news articles..."})]}):0===(null===S||void 0===S||null===(t=S.data)||void 0===t?void 0:t.length)?(0,j.jsxs)("div",{className:"p-8 text-center",children:[(0,j.jsx)(d.A,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,j.jsx)("p",{className:"text-gray-600 text-lg mb-4",children:"No news articles found."}),(0,j.jsxs)("button",{onClick:()=>k(!0),className:"btn-primary",children:[(0,j.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Create Your First Article"]})]}):(0,j.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6",children:null===S||void 0===S||null===(s=S.data)||void 0===s?void 0:s.map((e=>{return(0,j.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white shadow-md hover:shadow-lg transition-shadow duration-300 flex flex-col",children:[(0,j.jsx)("div",{className:"w-full h-48 bg-gray-200 flex items-center justify-center overflow-hidden",children:e.attachments&&e.attachments.length>0?(0,j.jsx)("img",{src:y.getImageUrl(e.attachments[0].url),alt:e.name,className:"w-full h-full object-cover",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/400x200?text=No+Image"}}):(0,j.jsx)(m.A,{className:"h-16 w-16 text-gray-400"})}),(0,j.jsxs)("div",{className:"p-4 flex flex-col flex-grow",children:[(0,j.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2 line-clamp-2",children:e.name}),(0,j.jsx)("p",{className:"text-gray-600 text-sm mb-3 line-clamp-3 flex-grow",children:(t=e.shortDescription||e.content,s=120,t?t.length<=s?t:t.substring(0,s)+"...":"")}),(0,j.jsxs)("div",{className:"flex items-center text-xs text-gray-500 mb-4 mt-auto",children:[(0,j.jsx)(h.A,{className:"h-3 w-3 mr-1"}),(0,j.jsx)("span",{children:A(e.createdAt)}),(0,j.jsx)(x.A,{className:"h-3 w-3 ml-4 mr-1"}),(0,j.jsx)("span",{children:e.author||"EduSports Team"})]}),(0,j.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[(0,j.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,j.jsx)("button",{onClick:()=>window.open("/news/".concat(e.id),"_blank"),className:"btn-icon",title:"View Article",children:(0,j.jsx)(u.A,{className:"h-4 w-4"})}),(0,j.jsx)("button",{onClick:()=>window.open("/admin/news/".concat(e.id,"/edit"),"_blank"),className:"btn-icon text-blue-600 hover:text-blue-700",title:"Edit Article",children:(0,j.jsx)(g.A,{className:"h-4 w-4"})})]}),(0,j.jsx)("button",{onClick:()=>{return t=e.id,void(window.confirm("B\u1ea1n c\xf3 ch\u1eafc mu\u1ed1n x\xf3a b\xe0i \u0111\u0103ng n\xe0y?")&&O.mutate(t));var t},className:"btn-icon text-red-600 hover:text-red-700",title:"Delete Article",disabled:O.isLoading,children:(0,j.jsx)(p.A,{className:"h-4 w-4"})})]})]})]},e.id);var t,s}))}),(null===S||void 0===S||null===(N=S.pagination)||void 0===N?void 0:N.totalPages)>1&&(0,j.jsxs)("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6 flex items-center justify-between",children:[(0,j.jsxs)("div",{className:"text-sm text-gray-700",children:["Showing page ",(0,j.jsx)("span",{className:"font-medium",children:S.pagination.currentPage})," of ",(0,j.jsx)("span",{className:"font-medium",children:S.pagination.totalPages})," (",S.pagination.totalItems," items)"]}),(0,j.jsxs)("div",{className:"flex space-x-2",children:[(0,j.jsx)("button",{onClick:()=>C((e=>e-1)),disabled:!S.pagination.hasPrev||O.isLoading||P.isLoading,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,j.jsx)("button",{onClick:()=>C((e=>e+1)),disabled:!S.pagination.hasNext||O.isLoading||P.isLoading,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}),T&&(0,j.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,j.jsx)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-auto max-h-[90vh] overflow-y-auto",children:(0,j.jsxs)("div",{className:"p-6",children:[(0,j.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,j.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:"Create New News Article"}),(0,j.jsx)("button",{onClick:()=>k(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,j.jsx)(w.A,{className:"h-6 w-6"})})]}),(0,j.jsxs)("form",{onSubmit:e=>{e.preventDefault(),I.name&&""!==I.name.trim()?I.content&&""!==I.content.trim()?(console.log("DEBUG HANDLECREATE: newsForm state before calling mutate:",I),console.log("DEBUG HANDLECREATE: selectedFile state before calling mutate:",L),P.mutate({newsData:I,file:L})):v.Ay.error("N\u1ed9i dung tin t\u1ee9c kh\xf4ng \u0111\u01b0\u1ee3c \u0111\u1ec3 tr\u1ed1ng."):v.Ay.error("T\xean tin t\u1ee9c kh\xf4ng \u0111\u01b0\u1ee3c \u0111\u1ec3 tr\u1ed1ng.")},className:"space-y-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:["Article Name ",(0,j.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,j.jsx)("input",{id:"name",name:"name",type:"text",required:!0,className:"input-field",placeholder:"Enter article name...",value:I.name,onChange:H})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"shortDescription",className:"block text-sm font-medium text-gray-700 mb-2",children:"Short Description (Optional)"}),(0,j.jsx)("textarea",{id:"shortDescription",name:"shortDescription",rows:3,className:"input-field",placeholder:"Brief summary of the article...",value:I.shortDescription,onChange:H})]}),(0,j.jsxs)("div",{children:[(0,j.jsxs)("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-2",children:["Article Content ",(0,j.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,j.jsx)("textarea",{id:"content",name:"content",rows:8,required:!0,className:"input-field",placeholder:"Write your article content here...",value:I.content,onChange:H})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Image (Max 1 file, image format only)"}),(0,j.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},className:"btn btn-outline-primary btn-sm mb-2",children:"Ch\u1ecdn \u1ea3nh\u2026"}),(0,j.jsx)("input",{id:"file-upload",type:"file",accept:"image/*",onChange:e=>{const t=e.target.files&&e.target.files[0]?e.target.files[0]:null;B(t),console.log("DEBUG HANDLEFILECHANGE: File selected:",t)},ref:M,hidden:!0}),L&&(0,j.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["\u1ea2nh \u0111\xe3 ch\u1ecdn: ",L.name," (",(L.size/1024).toFixed(2)," KB)"]})]}),(0,j.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 pt-4",children:[(0,j.jsx)("button",{type:"button",onClick:()=>k(!1),className:"flex-1 btn-secondary",children:"H\u1ee7y"}),(0,j.jsx)("button",{type:"submit",disabled:P.isLoading,className:"flex-1 btn-primary disabled:opacity-50",children:P.isLoading?(0,j.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,j.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,j.jsx)("span",{children:"T\u1ea1o..."})]}):"T\u1ea1o"})]})]})]})})})]})}}}]);
//# sourceMappingURL=358.2d94eb77.chunk.js.map